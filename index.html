<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Luminis &raquo; Renderer Prototype</title>
		<link rel="stylesheet" type="text/css" href="css/viewport.css"/>
		<script src="js/jquery-1.6.4.min.js"></script>
		<script src="js/raphael-min.js"></script>
		<script src="js/sylvester.js"></script>
		<script type="text/javascript">
			$(function(){
				$("#viewports").addClass("viewports").children().addClass("viewport");
			});
		</script>
		<script>
			var scale = 70;
			var center = Vector.create([240,240]);
			
			var v0 = Vector.create([0,0]);
			var v1 = Vector.create([1,0]);
				
			var Scene3D = function() {
				var Scene2D = function() {
					this.elements = [];
				
					this.add = function(element) {
						this.elements.push(element);
						return this;			
					}
				}
				this.__proto__ = new Scene2D();
				
				this.transform = function(transformation) {
					var scene2D = new Scene2D();
					for (var i = 0; i < this.elements.length; i++) {
						scene2D.add(transformation(this.elements[i]));
					}
					return scene2D;
				}
			}
			
			var scene = new Scene3D().add(Vector.create([0,0,0])).add(Vector.create([1,0,0]));
				
			var projection = function(m) {
				var matrix = Matrix.create(m);
				return function(v) {return matrix.multiply(v);};
			}
			
			var viewportTransform = function(scale, center) {
				return function(v) {return v.x(scale).add(center);};
			}
		</script>
		<script type="text/javascript">
			$(function(){
				var options = [
					{id: "xy", axis: true, projection: projection([[1,0,0],[0,1,0]]), viewport: viewportTransform(70,center)}, 
					{id: "xz", axis: true, projection: projection([[1,0,0],[0,0,1]]), viewport: viewportTransform(70,center)},
					{id: "yz", axis: true, projection: projection([[0,1,0],[0,0,1]]), viewport: viewportTransform(70,center)},
					{id: "xyz", axis: false, viewport: viewportTransform(70,center)}
				];
				
				for (var index = 0; index < options.length; index++) {
					var o = options[index];
					var paper = Raphael(o.id, 480, 480);
					
					if (o.axis) {
						paper.path("M240 0L240 480").attr({stroke: 'gray'});
						paper.path("M0 240L480 240").attr({stroke: 'gray'});
					}
					
					if (o.projection) {
						var scene2D = scene.transform(o.projection);
						var sceneElements = scene2D.elements
						for (var i = 0; i < sceneElements.length; i++) {
							var point = o.viewport(sceneElements[i]);
							paper.circle(point.e(1),point.e(2),3).attr({fill: 'black', stroke: 'black'});
						}
					}
				}
			});
		</script>
	</head>
	<body>
		<h1>Renderer Prototype</h1>
		<div id="viewports">
			<div id="xy"></div><div id="xz"></div><div id="yz"></div><div id="xyz"></div>
		</div>
	</body>
</html>
